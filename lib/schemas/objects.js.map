{"version":3,"file":"objects.js","sources":["../../src/schemas/objects.ts"],"sourcesContent":["import { z } from 'zod';\n\n// #region Configuration\n// #region permissions\nexport const permissionsShape = {\n  __read: z.string().array(),\n  __write: z.string().array(),\n  __remove: z.string().array(),\n};\n\nexport const collectionPermissionsShape = {\n  __create: z.string().array(),\n  ...permissionsShape,\n};\n\n// #endregion\n// #endregion\n\nexport const timestampsSchema = z.object({\n  _created: z.object({ date: z.date(), by: z.string() }),\n  _updatedAt: z.object({ date: z.date(), by: z.string() }),\n  _deletedAt: z.union([\n    z.literal(false),\n    z.object({ date: z.date(), by: z.string() }),\n  ]),\n});\n\nconst _entitySchema = z.object({\n  _id: z.string(),\n  ...timestampsSchema.shape,\n});\n\nexport function entitySchema<T extends []>(\n  ...shape: T\n): typeof _entitySchema;\n\nexport function entitySchema<T extends [z.ZodRawShape]>(\n  ...shape: T\n): z.ZodObject<(typeof _entitySchema)['shape'] & T[0]>;\n\nexport function entitySchema<T extends [z.ZodRawShape] | []>(\n  ...shapes: T\n) {\n  const shape = shapes[0];\n  if (shape) {\n    return _entitySchema.extend(shape);\n  }\n  return _entitySchema;\n}\n\nexport const actorSchema = entitySchema().extend({\n  // ip: string().url().optional(),\n  __privateKey: z.string(),\n  permissions: z.string().array(),\n});\n\nexport const loginSchema = z.object({\n  login: z.string(),\n  password: z.string().min(6),\n});\n\nexport const userSchema = z.object({ __privateKey: z.string() });\n\nexport const phoneNumber = z.tuple([z.number().array(), z.number()]);\n\nexport const humanSchema = z.object({\n  firstNames: z.string().array().optional(),\n  lastName: z.string().min(1).optional(),\n  bio: z.string().min(100).optional(),\n  mail: z.string().email().optional(),\n  phoneNumber: phoneNumber.array().optional(),\n});\n\nexport const user = entitySchema().extend(loginSchema.shape);\n\n// #region Generics\nexport const withoutID = (shape: z.ZodRawShape) =>\n  z.object(shape).omit({ _id: true });\n\nconst perimissionsBools = {\n  __read: true,\n  __write: true,\n  __remove: true,\n} as const;\n\ntype AddAny<T extends z.ZodRawShape, Arr extends string> = T &\n  Record<Arr, z.ZodTypeAny>;\n\nexport function withoutPermissions<T extends z.ZodRawShape>(shape: T) {\n  const _shape = shape as AddAny<T, keyof typeof perimissionsBools>;\n  return z.object(_shape).omit(perimissionsBools);\n}\n\nexport function withoutPassword<T extends z.ZodRawShape>(shape: T) {\n  const _shape = shape as AddAny<T, 'password'>;\n  return z.object(_shape).omit({\n    password: true,\n  });\n}\n\nexport function withID<T extends z.ZodRawShape>(shape: T) {\n  return z.object(shape).extend({ _id: z.string() });\n}\n\nexport const atomicDataSchema = <T extends z.ZodRawShape | z.ZodTypeAny>(\n  shape: T,\n) => {\n  const data = (\n    shape instanceof z.ZodType ? shape : z.object(shape)\n  ) as T extends z.ZodRawShape ? z.ZodObject<T> : T;\n\n  return z.object({\n    data,\n    ...permissionsShape,\n  });\n};\n// #endregion\n"],"names":[],"mappings":"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"}